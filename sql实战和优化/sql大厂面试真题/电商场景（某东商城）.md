# 电商场景（某东商城）

## **SQL168** 计算商城中2021年每月的GMV

https://www.nowcoder.com/practice/5005cbf5308249eda1fbf666311753bf

### 题眼：

1.每月的GMV：date_format(event_time,'%Y-%m')

2.根据月份分组：group by

3.过滤部分条件：having

### sql

```sql
SELECT
	date_format(event_time, '%Y-%m') `month`,
	sum(total_amount) GMV
from
	tb_order_overall
where
	(status != 2)
	and year(event_time) = 2021
group by
	`month`
having
	GMV > 100000
order by
	GMV
```



## **SQL169** **统计2021年10月每个退货率不大于0.5的商品各项指标**

https://www.nowcoder.com/practice/cbf582d28b794722becfc680847327be

### 题眼：

1.商品点展比=点击数÷展示数：round(sum(if_click)/ count(1), 3) 

2.加购率=加购数÷点击数：round(sum(if_cart)/ sum(if_click), 3)

3.成单率=付款数÷加购数：round(sum(if_payment)/ sum(if_cart), 3)

4.退货率=退款数÷付款数：round(sum(if_refund)/ sum(if_payment), 3) 

### sql

```sql
select
	product_id,
	round(sum(if_click)/ count(1), 3) ctr,
	round(sum(if_cart)/ sum(if_click), 3) cart_rate,
	round(sum(if_payment)/ sum(if_cart), 3) payment_rate,
	round(sum(if_refund)/ sum(if_payment), 3) refund_rate
from
	tb_user_event
where
	DATE_FORMAT(event_time, '%Y-%m') = '2021-10'
group by
	product_id
having
	refund_rate <= 0.5
order by
	product_id
```

## **SQL171** 零食类商品中复购率top3高的商品

https://www.nowcoder.com/practice/9c175775e7ad4d9da41602d588c5caf3

### 题眼

1.近90天内购买：DATE_SUB(date,INTERVAL expr type)

DATE_SUB(MAX(event_time), INTERVAL 89 DAY)

### sql

```sql
SELECT product_id,
    ROUND(SUM(repurchase) / COUNT(repurchase), 3) as repurchase_rate
FROM (
    SELECT product_id, IF(COUNT(event_time)>1, 1, 0) as repurchase
    FROM tb_order_detail
    JOIN tb_order_overall USING(order_id)
    JOIN tb_product_info USING(product_id)
    WHERE tag='零食' AND event_time >= (
        SELECT DATE_SUB(MAX(event_time), INTERVAL 89 DAY)
        FROM tb_order_overall
    )
    GROUP BY uid, product_id
) as t_uid_product_info
GROUP BY product_id
ORDER BY repurchase_rate DESC, product_id
LIMIT 3;

```

